<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rich Text Editor</title>
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        margin: 0;
        background-color: #000;
      }
      * {
        box-sizing: border-box;
      }
      #editor {
        width: 640px;
        max-width: 100%;
        height: 360px;
        border: 1px solid #ccc;
        padding: 10px;
        font-size: 16px;
        border-radius: 12px;
        color: #fff;
        caret-color: #723fff;
      }
      .container {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        width: 100%;
        height: 100%;
        padding: 16px;
      }
      .btn-area {
        padding: 24px 16px;
      }
      .btn-feature {
        background-color: #723fff;
        color: #fff;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="editor" contenteditable="true"></div>
      <div class="btn-area">
        <button class="btn-feature" onclick="handleGetSelecttion()">
          è·å–é€‰åŒº
        </button>
        <button class="btn-feature" onclick="handleInsertImage()">
          æ’å…¥å›¾ç‰‡èŠ‚ç‚¹
        </button>
        <button class="btn-feature" onclick="handleInsertSpan()">
          æ’å…¥span
        </button>
        <button class="btn-feature" onclick="handleInsert()">æ’å…¥ğŸ˜Š</button>
      </div>
    </div>
    <script>
      function checkSelection() {
        const editor = document.getElementById('editor');
        if (editor) {
          editor.focus(); // ç¡®ä¿ç¼–è¾‘å™¨è·å¾—ç„¦ç‚¹
          const range = document.createRange();
          range.selectNodeContents(editor);
          range.collapse(false); // æŠ˜å åˆ°å†…å®¹çš„æœ«å°¾

          // è·å– Selection å¯¹è±¡å¹¶è®¾ç½®æ–°çš„ Range
          const selection = window.getSelection();
          selection.removeAllRanges(); // æ¸…é™¤ä¹‹å‰çš„é€‰åŒº
          selection.addRange(range); // è®¾ç½®æ–°çš„é€‰åŒº
          return true; // è¿”å› true è¡¨ç¤ºç¼–è¾‘å™¨å­˜åœ¨
        }
        return false;
      }
      function handleInsert() {
        if (!checkSelection()) {
          console.log('ç¼–è¾‘å™¨ä¸å­˜åœ¨æˆ–æœªè·å¾—ç„¦ç‚¹ï¼Œæ— æ³•æ’å…¥å†…å®¹ã€‚');
          return;
        }
        window.getSelection().deleteFromDocument();
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const textNode = document.createTextNode('ğŸ˜Š');
          range.insertNode(textNode);
          // å°†å…‰æ ‡ç§»åŠ¨åˆ°æ’å…¥çš„è¡¨æƒ…ç¬¦å·åé¢
          range.setStartAfter(textNode);
          range.collapse(true);
          selection.removeAllRanges(); // æ¸…é™¤ä¹‹å‰çš„é€‰åŒº
          selection.addRange(range); // è®¾ç½®æ–°çš„é€‰åŒº
        } else {
          console.log('No selection found to insert text.');
        }
      }
      function handleInsertImage() {
        if (!checkSelection()) {
          console.log('ç¼–è¾‘å™¨ä¸å­˜åœ¨æˆ–æœªè·å¾—ç„¦ç‚¹ï¼Œæ— æ³•æ’å…¥å†…å®¹ã€‚');
          return;
        }
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const imgNode = document.createElement('img');
          imgNode.src = 'https://via.placeholder.com/150'; // å›¾ç‰‡çš„ URL
          imgNode.alt = 'æ’å…¥çš„å›¾ç‰‡'; // å›¾ç‰‡çš„æè¿°
          imgNode.style.width = '50px'; // è®¾ç½®å›¾ç‰‡å®½åº¦
          imgNode.style.height = '50px'; // è®¾ç½®å›¾ç‰‡é«˜åº¦
          range.insertNode(imgNode); // æ’å…¥å›¾ç‰‡èŠ‚ç‚¹
          // å°†å…‰æ ‡ç§»åŠ¨åˆ°å›¾ç‰‡ä¹‹å
          range.setStartAfter(imgNode);
          range.collapse(true);
          selection.removeAllRanges();
          selection.addRange(range);
        } else {
          console.log('No selection found.');
        }
      }
      function handleInsertSpan() {
        if (!checkSelection()) {
          console.log('ç¼–è¾‘å™¨ä¸å­˜åœ¨æˆ–æœªè·å¾—ç„¦ç‚¹ï¼Œæ— æ³•æ’å…¥å†…å®¹ã€‚');
          return;
        }
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const spanNode = document.createElement('span');
          spanNode.textContent = 'æ’å…¥çš„å†…å®¹'; // è®¾ç½® `span` çš„æ–‡æœ¬å†…å®¹
          spanNode.style.color = '#723fff'; // è®¾ç½®æ ·å¼
          spanNode.style.fontWeight = 'bold';
          range.insertNode(spanNode); // æ’å…¥ `span` èŠ‚ç‚¹
          // å°†å…‰æ ‡ç§»åŠ¨åˆ° `span` ä¹‹å
          range.setStartAfter(spanNode);
          range.collapse(true);
          selection.removeAllRanges();
          selection.addRange(range);
        } else {
          console.log('No selection found.');
        }
      }
      function handleGetSelecttion() {
        if (!checkSelection()) {
          console.log('ç¼–è¾‘å™¨ä¸å­˜åœ¨æˆ–æœªè·å¾—ç„¦ç‚¹ï¼Œæ— æ³•è·å–é€‰åŒºã€‚');
          return;
        }
        console.log('è·å–é€‰åŒºæŒ‰é’®è¢«ç‚¹å‡»äº†');
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const startContainer = range.startContainer;
          const endContainer = range.endContainer;
          const startOffset = range.startOffset;
          const endOffset = range.endOffset;
          const anchorNode = selection.anchorNode;
          const focusNode = selection.focusNode;
          const anchorOffset = selection.anchorOffset;
          const focusOffset = selection.focusOffset;
          const type = selection.type;

          console.log('Selection Type:', type);
          console.log('Anchor Node:', anchorNode);
          console.log('Focus Node:', focusNode);
          console.log('Anchor Offset:', anchorOffset);
          console.log('Focus Offset:', focusOffset);
          console.log('Start Container:', startContainer);
          console.log('End Container:', endContainer);
          console.log('Start Offset:', startOffset);
          console.log('End Offset:', endOffset);
        } else {
          console.log('No selection found.');
        }
      }
    </script>
  </body>
</html>
